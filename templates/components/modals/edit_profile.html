<div id="edit-profile-modal" 
     class="fixed inset-0 z-[60] hidden" 
     aria-labelledby="modal-title" 
     role="dialog" 
     aria-modal="true">
    
    <div class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" 
         onclick="document.getElementById('edit-profile-modal').classList.add('hidden')"></div>

    <div class="fixed inset-0 z-10 overflow-y-auto">
        <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
            
            <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-2xl transition-all sm:my-8 w-full max-w-2xl border border-slate-200"
                 x-data="{ activeTab: 'basic' }">
                
                <div class="flex items-center justify-between px-6 py-4 border-b border-slate-100 bg-white">
                    <h3 class="text-lg font-bold text-slate-900 flex items-center gap-2">
                        <i class="fas fa-user-edit text-indigo-500"></i> Editar Perfil
                    </h3>
                    <button type="button" onclick="document.getElementById('edit-profile-modal').classList.add('hidden')" class="text-slate-400 hover:text-slate-600 transition w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-100">
                        <i class="fas fa-times text-lg"></i>
                    </button>
                </div>

                <form action="{% url 'edit_profile' %}" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="hidden" name="action_type" value="full_update">

                    <div class="flex border-b border-slate-100 bg-slate-50/80 px-6 gap-6 sticky top-0 z-10 backdrop-blur-md">
                        <button type="button" @click="activeTab = 'basic'" 
                                class="py-4 text-sm font-bold border-b-2 transition flex items-center gap-2"
                                :class="activeTab === 'basic' ? 'border-indigo-600 text-indigo-600' : 'border-transparent text-slate-500 hover:text-slate-800 hover:border-slate-300'">
                            <i class="fas fa-id-card"></i> Básico
                        </button>
                        <button type="button" @click="activeTab = 'visual'" 
                                class="py-4 text-sm font-bold border-b-2 transition flex items-center gap-2"
                                :class="activeTab === 'visual' ? 'border-indigo-600 text-indigo-600' : 'border-transparent text-slate-500 hover:text-slate-800 hover:border-slate-300'">
                            <i class="fas fa-image"></i> Visual
                        </button>
                        <button type="button" @click="activeTab = 'details'" 
                                class="py-4 text-sm font-bold border-b-2 transition flex items-center gap-2"
                                :class="activeTab === 'details' ? 'border-indigo-600 text-indigo-600' : 'border-transparent text-slate-500 hover:text-slate-800 hover:border-slate-300'">
                            <i class="fas fa-info-circle"></i> Detalhes
                        </button>
                        <button type="button" @click="activeTab = 'interests'" 
                                class="py-4 text-sm font-bold border-b-2 transition flex items-center gap-2"
                                :class="activeTab === 'interests' ? 'border-indigo-600 text-indigo-600' : 'border-transparent text-slate-500 hover:text-slate-800 hover:border-slate-300'">
                            <i class="fas fa-heart"></i> Interesses
                        </button>
                    </div>

                    <div class="p-6 max-h-[60vh] overflow-y-auto custom-scrollbar bg-white">
                        
                        <div x-show="activeTab === 'basic'" class="space-y-5" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 translate-y-2" x-transition:enter-end="opacity-100 translate-y-0">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1">Nome</label>
                                    <input type="text" name="first_name" value="{{ user.first_name }}" class="w-full rounded-xl border-slate-200 bg-slate-50 focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 transition py-2.5">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1">Sobrenome</label>
                                    <input type="text" name="last_name" value="{{ user.last_name }}" class="w-full rounded-xl border-slate-200 bg-slate-50 focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 transition py-2.5">
                                </div>
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1">Nome de Exibição (Completo)</label>
                                <input type="text" name="full_name" value="{{ user.profile.full_name }}" placeholder="Como aparece no seu perfil" class="w-full rounded-xl border-slate-200 bg-slate-50 focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 transition py-2.5">
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1">Bio / Manifesto</label>
                                <textarea name="bio" rows="3" class="w-full rounded-xl border-slate-200 bg-slate-50 focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="Escreva algo sobre você...">{{ user.profile.bio }}</textarea>
                                <p class="text-xs text-slate-400 mt-1 text-right">Seja autêntico.</p>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1">Cidade Atual</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400"><i class="fas fa-map-marker-alt"></i></div>
                                        <input type="text" name="current_city" value="{{ user.profile.current_city }}" class="pl-10 w-full rounded-xl border-slate-200 bg-slate-50 focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 transition py-2.5">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1">Cidade Natal</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400"><i class="fas fa-home"></i></div>
                                        <input type="text" name="hometown" value="{{ user.profile.hometown }}" class="pl-10 w-full rounded-xl border-slate-200 bg-slate-50 focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 transition py-2.5">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div x-show="activeTab === 'visual'" style="display: none;" class="space-y-6" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 translate-y-2" x-transition:enter-end="opacity-100 translate-y-0">
                            
                            <div class="flex items-center gap-4 p-4 border border-slate-100 rounded-2xl bg-slate-50/50 hover:bg-slate-50 transition">
                                <div class="h-20 w-20 rounded-full bg-slate-200 overflow-hidden shrink-0 border-2 border-white shadow-md">
                                    {% if user.profile.avatar %}
                                        <img src="{{ user.profile.avatar.url }}" class="w-full h-full object-cover">
                                    {% else %}
                                        <div class="w-full h-full flex items-center justify-center text-slate-400"><i class="fas fa-user text-2xl"></i></div>
                                    {% endif %}
                                </div>
                                <div class="flex-1">
                                    <label class="block text-sm font-bold text-slate-800 mb-1">Foto de Perfil</label>
                                    <p class="text-xs text-slate-500 mb-3">Recomendado: 400x400px</p>
                                    <input type="file" name="avatar" accept="image/*" class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-bold file:bg-indigo-100 file:text-indigo-700 hover:file:bg-indigo-200 transition cursor-pointer">
                                </div>
                            </div>

                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-slate-800 ml-1">Foto de Capa</label>
                                <div class="relative h-36 w-full bg-slate-100 rounded-2xl overflow-hidden border-2 border-dashed border-slate-300 flex items-center justify-center group hover:border-indigo-400 hover:bg-slate-50 transition cursor-pointer">
                                    {% if user.profile.cover_image %}
                                        <img src="{{ user.profile.cover_image.url }}" class="absolute inset-0 w-full h-full object-cover opacity-60 group-hover:opacity-40 transition">
                                    {% endif %}
                                    <div class="relative z-10 text-center">
                                        <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center mx-auto mb-2 shadow-sm text-indigo-500 group-hover:scale-110 transition">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                        </div>
                                        <p class="text-xs font-bold text-slate-600">Clique para alterar a capa</p>
                                        <p class="text-[10px] text-slate-400">JPG, PNG ou GIF</p>
                                        <input type="file" name="cover" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div x-show="activeTab === 'details'" style="display: none;" class="space-y-5" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 translate-y-2" x-transition:enter-end="opacity-100 translate-y-0">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1">Email Público</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400"><i class="fas fa-envelope"></i></div>
                                    <input type="email" name="public_email" value="{{ user.profile.public_email }}" class="pl-10 w-full rounded-xl border-slate-200 bg-slate-50 focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 transition py-2.5">
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1">Telefone</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400"><i class="fas fa-phone"></i></div>
                                        <input type="text" name="phone" value="{{ user.profile.phone }}" class="pl-10 w-full rounded-xl border-slate-200 bg-slate-50 focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 transition py-2.5">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1">Nascimento</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400"><i class="fas fa-birthday-cake"></i></div>
                                        <input type="date" name="birth_date" value="{{ user.profile.birth_date|date:'Y-m-d' }}" class="pl-10 w-full rounded-xl border-slate-200 bg-slate-50 focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 transition py-2.5">
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1">Gênero</label>
                                <select name="gender" class="w-full rounded-xl border-slate-200 bg-slate-50 focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 transition py-2.5 text-slate-600">
                                    <option value="M" {% if user.profile.gender == 'M' %}selected{% endif %}>Masculino</option>
                                    <option value="F" {% if user.profile.gender == 'F' %}selected{% endif %}>Feminino</option>
                                    <option value="O" {% if user.profile.gender == 'O' %}selected{% endif %}>Outro / Prefiro não dizer</option>
                                </select>
                            </div>
                        </div>

                        <div x-show="activeTab === 'interests'" style="display: none;" class="space-y-5" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 translate-y-2" x-transition:enter-end="opacity-100 translate-y-0">
                            <div class="bg-blue-50 border border-blue-100 p-4 rounded-xl flex items-start gap-3 text-xs text-blue-700">
                                <i class="fas fa-lightbulb text-lg mt-0.5"></i>
                                <p>Preencha seus interesses para conectar com tribos semelhantes. Use vírgulas para separar.</p>
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1"><i class="fas fa-music mr-1"></i> Música</label>
                                <input type="text" name="interest_music" value="{{ user.profile.interests.music }}" placeholder="Rock, Jazz, Indie..." class="w-full rounded-xl border-slate-200 bg-slate-50 focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 transition py-2.5">
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1"><i class="fas fa-film mr-1"></i> Filmes & Séries</label>
                                <input type="text" name="interest_movies" value="{{ user.profile.interests.movies }}" placeholder="Sci-Fi, Drama, Anime..." class="w-full rounded-xl border-slate-200 bg-slate-50 focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 transition py-2.5">
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1"><i class="fas fa-gamepad mr-1"></i> Games</label>
                                <input type="text" name="interest_games" value="{{ user.profile.interests.games }}" placeholder="RPG, FPS, Estratégia..." class="w-full rounded-xl border-slate-200 bg-slate-50 focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 transition py-2.5">
                            </div>
                            
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1"><i class="fas fa-futbol mr-1"></i> Esportes</label>
                                <input type="text" name="interest_sports" value="{{ user.profile.interests.sports }}" placeholder="Futebol, Basquete, E-Sports..." class="w-full rounded-xl border-slate-200 bg-slate-50 focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 transition py-2.5">
                            </div>
                        </div>

                    </div>

                    <div class="px-6 py-4 bg-slate-50 border-t border-slate-200 flex justify-end gap-3 rounded-b-2xl">
                        <button type="button" onclick="document.getElementById('edit-profile-modal').classList.add('hidden')" class="px-5 py-2.5 rounded-xl font-bold text-slate-500 hover:bg-white hover:text-slate-800 border border-transparent hover:border-slate-200 transition">
                            Cancelar
                        </button>
                        <button type="submit" class="px-8 py-2.5 rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white font-bold shadow-lg shadow-indigo-200 transition transform active:scale-95 flex items-center gap-2">
                            <i class="fas fa-save"></i> Salvar
                        </button>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Auto-binding para abrir o modal quando clicar no botão de editar
    document.addEventListener('DOMContentLoaded', () => {
        const triggerBtn = document.getElementById('edit-profile-btn');
        const modal = document.getElementById('edit-profile-modal');
        
        if(triggerBtn && modal) {
            triggerBtn.addEventListener('click', (e) => {
                e.preventDefault();
                modal.classList.remove('hidden');
            });
        }
    });
</script>