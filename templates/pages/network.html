{% extends 'layout/base_bird.html' %}
{% load static %}

{% block main_content %}
<div class="relative min-h-full w-full overflow-y-auto no-scrollbar font-sans text-slate-800" x-data="{ currentTab: 'requests' }">

    <div class="fixed inset-0 -z-10 bg-[#F5F7FA]">
        <div class="absolute top-[20%] left-[10%] w-[600px] h-[600px] bg-pink-300/20 rounded-full blur-[120px] animate-pulse"></div>
        <div class="absolute bottom-[10%] right-[5%] w-[500px] h-[500px] bg-indigo-300/20 rounded-full blur-[120px] animate-pulse delay-1000"></div>
    </div>

    <div class="max-w-6xl mx-auto px-4 py-8 pb-32">

        <div class="flex items-center justify-between mb-8">
            <div class="flex items-center gap-4">
                <a href="{% url 'profile_detail' user.username %}" class="w-12 h-12 rounded-full bg-white/60 backdrop-blur-md border border-white/60 flex items-center justify-center text-slate-600 hover:bg-white transition shadow-sm">
                    <i class="fas fa-arrow-left"></i>
                </a>
                <div>
                    <h1 class="text-3xl font-black text-slate-800 tracking-tight">Sua Rede</h1>
                    <p class="text-slate-500 font-medium">Gerencie suas conex√µes e descubra pessoas.</p>
                </div>
            </div>
            
            <div class="hidden md:block relative">
                <input type="text" placeholder="Buscar algu√©m..." class="pl-10 pr-4 py-2.5 rounded-xl bg-white/50 border border-white/60 focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 transition w-64 shadow-sm">
                <i class="fas fa-search absolute left-3.5 top-3.5 text-slate-400"></i>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

            <div class="lg:col-span-3">
                <div class="bg-white/60 backdrop-blur-xl border border-white/60 rounded-[2rem] p-4 shadow-sm sticky top-24 space-y-2">
                    
                    <button @click="currentTab = 'requests'" 
                            class="w-full text-left px-4 py-3 rounded-xl font-bold text-sm flex items-center justify-between transition"
                            :class="currentTab === 'requests' ? 'bg-slate-900 text-white shadow-lg shadow-slate-900/20' : 'text-slate-600 hover:bg-white/50'">
                        <span class="flex items-center gap-3"><i class="fas fa-user-plus text-lg w-6"></i> Solicita√ß√µes</span>
                        {% if pending_requests_count > 0 %}
                            <span class="bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-full">{{ pending_requests_count }}</span>
                        {% endif %}
                    </button>

                    <button @click="currentTab = 'connections'" 
                            class="w-full text-left px-4 py-3 rounded-xl font-bold text-sm flex items-center gap-3 transition"
                            :class="currentTab === 'connections' ? 'bg-slate-900 text-white shadow-lg shadow-slate-900/20' : 'text-slate-600 hover:bg-white/50'">
                        <i class="fas fa-users text-lg w-6"></i> Conex√µes (Amigos)
                    </button>

                    <button @click="currentTab = 'following'" 
                            class="w-full text-left px-4 py-3 rounded-xl font-bold text-sm flex items-center gap-3 transition"
                            :class="currentTab === 'following' ? 'bg-slate-900 text-white shadow-lg shadow-slate-900/20' : 'text-slate-600 hover:bg-white/50'">
                        <i class="fas fa-user-check text-lg w-6"></i> Seguindo
                    </button>

                    <button @click="currentTab = 'followers'" 
                            class="w-full text-left px-4 py-3 rounded-xl font-bold text-sm flex items-center gap-3 transition"
                            :class="currentTab === 'followers' ? 'bg-slate-900 text-white shadow-lg shadow-slate-900/20' : 'text-slate-600 hover:bg-white/50'">
                        <i class="fas fa-bullhorn text-lg w-6"></i> Seguidores
                    </button>

                    <div class="h-px bg-slate-200/60 my-2"></div>

                    <button @click="currentTab = 'suggestions'" 
                            class="w-full text-left px-4 py-3 rounded-xl font-bold text-sm flex items-center gap-3 text-indigo-600 hover:bg-indigo-50 transition">
                        <i class="fas fa-magic text-lg w-6"></i> Sugest√µes
                    </button>

                </div>
            </div>

            <div class="lg:col-span-9">
                
                <div x-show="currentTab === 'requests'" x-transition:enter="transition ease-out duration-300 transform" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0">
                    <h2 class="text-xl font-black text-slate-800 mb-6 px-2">Solicita√ß√µes de V√≠nculo</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {% for req in friend_requests %}
                        <div class="bg-white/70 backdrop-blur-xl border border-white/80 rounded-[1.5rem] p-5 shadow-sm flex items-center gap-4 transition hover:shadow-md">
                            <img src="{{ req.requester.profile.avatar.url|default:'https://ui-avatars.com/api/?background=random' }}" class="w-16 h-16 rounded-full object-cover border-2 border-white shadow-sm">
                            <div class="flex-1 min-w-0">
                                <h4 class="font-bold text-slate-900 truncate">{{ req.requester.profile.full_name }}</h4>
                                <p class="text-xs text-slate-500 mb-2">Quer ser seu: <strong class="text-indigo-600 uppercase">{{ req.get_type_display }}</strong></p>
                                <div class="flex gap-2">
                                    <a href="{% url 'manage_bond' req.id 'accept' %}" class="flex-1 bg-slate-900 text-white text-center py-1.5 rounded-lg text-xs font-bold hover:bg-black transition">Aceitar</a>
                                    <a href="{% url 'manage_bond' req.id 'reject' %}" class="px-3 bg-slate-200 text-slate-600 flex items-center justify-center rounded-lg hover:bg-slate-300 transition"><i class="fas fa-times"></i></a>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="col-span-full py-16 text-center">
                            <div class="w-16 h-16 bg-white/50 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-300 text-2xl">
                                <i class="fas fa-inbox"></i>
                            </div>
                            <p class="text-slate-500 font-medium">Nenhuma solicita√ß√£o pendente.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div x-show="currentTab === 'connections'" style="display: none;" x-transition:enter="transition ease-out duration-300 transform" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0">
                    <h2 class="text-xl font-black text-slate-800 mb-6 px-2">Suas Conex√µes</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {% for friend in connections %}
                        <div class="bg-white/70 backdrop-blur-xl border border-white/80 rounded-[1.5rem] p-5 shadow-sm text-center group hover:bg-white transition">
                            <div class="relative w-20 h-20 mx-auto mb-3">
                                <img src="{{ friend.profile.avatar.url|default:'https://ui-avatars.com/api/?background=random' }}" class="w-full h-full rounded-full object-cover border-4 border-white shadow-sm">
                                <div class="absolute bottom-0 right-0 w-5 h-5 bg-green-400 border-2 border-white rounded-full"></div>
                            </div>
                            <h4 class="font-bold text-slate-900 text-lg truncate">{{ friend.first_name }}</h4>
                            <p class="text-xs text-slate-500 mb-4">@{{ friend.username }}</p>
                            
                            <div class="flex justify-center gap-2 opacity-80 group-hover:opacity-100 transition">
                                <a href="{% url 'start_chat' friend.username %}" class="w-10 h-10 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center hover:bg-indigo-100 transition"><i class="fas fa-comment-alt"></i></a>
                                <a href="{% url 'profile_detail' friend.username %}" class="w-10 h-10 rounded-full bg-slate-100 text-slate-600 flex items-center justify-center hover:bg-slate-200 transition"><i class="fas fa-user"></i></a>
                            </div>
                        </div>
                        {% empty %}
                        <div class="col-span-full py-16 text-center">
                            <p class="text-slate-500 font-medium">Voc√™ ainda n√£o tem conex√µes m√∫tuas.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div x-show="currentTab === 'following'" style="display: none;" x-transition:enter="transition ease-out duration-300 transform" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0">
                    <h2 class="text-xl font-black text-slate-800 mb-6 px-2">Pessoas que voc√™ segue</h2>
                    <div class="space-y-3">
                        {% for user_obj in following %}
                        <div class="bg-white/50 backdrop-blur-md border border-white/60 rounded-2xl p-4 flex items-center justify-between hover:bg-white/80 transition">
                            <a href="{% url 'profile_detail' user_obj.username %}" class="flex items-center gap-4">
                                <img src="{{ user_obj.profile.avatar.url|default:'https://ui-avatars.com/api/?background=random' }}" class="w-12 h-12 rounded-full object-cover">
                                <div>
                                    <h4 class="font-bold text-slate-900">{{ user_obj.profile.full_name }}</h4>
                                    <p class="text-xs text-slate-500">@{{ user_obj.username }}</p>
                                </div>
                            </a>
                            <form action="{% url 'toggle_follow' user_obj.username %}" method="POST">
                                {% csrf_token %}
                                <button class="px-4 py-1.5 border border-slate-300 rounded-lg text-xs font-bold text-slate-600 hover:bg-red-50 hover:text-red-500 hover:border-red-200 transition">Deixar de Seguir</button>
                            </form>
                        </div>
                        {% empty %}
                        <p class="text-center text-slate-500 py-10">Voc√™ n√£o est√° seguindo ningu√©m.</p>
                        {% endfor %}
                    </div>
                </div>

                <div x-show="currentTab === 'followers'" style="display: none;" x-transition:enter="transition ease-out duration-300 transform" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0">
                    <h2 class="text-xl font-black text-slate-800 mb-6 px-2">Seus Seguidores</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {% for user_obj in followers %}
                        <a href="{% url 'profile_detail' user_obj.username %}" class="bg-white/50 backdrop-blur-md border border-white/60 rounded-2xl p-4 flex items-center gap-4 hover:bg-white/80 transition group">
                            <img src="{{ user_obj.profile.avatar.url|default:'https://ui-avatars.com/api/?background=random' }}" class="w-12 h-12 rounded-full object-cover group-hover:scale-110 transition">
                            <div>
                                <h4 class="font-bold text-slate-900">{{ user_obj.profile.full_name }}</h4>
                                <p class="text-xs text-slate-500">Seguindo voc√™</p>
                            </div>
                        </a>
                        {% empty %}
                        <p class="col-span-full text-center text-slate-500 py-10">Ainda sem seguidores.</p>
                        {% endfor %}
                    </div>
                </div>

                <div x-show="currentTab === 'suggestions'" style="display: none;" x-transition:enter="transition ease-out duration-300 transform" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0">
                    <h2 class="text-xl font-black text-slate-800 mb-6 px-2">Pessoas que voc√™ pode conhecer</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-[1.5rem] p-5 text-center text-white shadow-lg relative overflow-hidden group">
                            <div class="absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition"></div>
                            <div class="w-16 h-16 rounded-full bg-white/20 mx-auto mb-3 flex items-center justify-center text-2xl">üöÄ</div>
                            <h4 class="font-bold text-lg">Descobrir</h4>
                            <p class="text-xs text-indigo-100 mb-4">Explore a comunidade Bird.</p>
                            <a href="{% url 'explore' %}" class="inline-block w-full py-2 bg-white text-indigo-600 font-bold rounded-lg text-sm hover:bg-indigo-50 transition">Explorar agora</a>
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>
</div>
{% endblock %}